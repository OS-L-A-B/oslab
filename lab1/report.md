---
title: lab 1：比麻雀更小的麻雀（最小可执行内核）
author: 钱俊玮 朱荟宇 邹博闻
---
# <center>lab 1：比麻雀更小的麻雀（最小可执行内核）</center>

#### <center> 钱俊玮&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;朱荟宇&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;邹博闻 </center>
#### <center> 2312480&nbsp;2311824&nbsp;2312251 </center>



### 练习1：理解内核启动中的程序入口操作

在内核启动时，需要完成一系列初始化操作，以建立基本的运行环境。而当OpenSBI刚将CPU的PC指向操作系统内核的入口地址时，操作系统此时处于裸机状态，没有可用的栈空间来保存局部变量或函数调用信息，所以需要预留一块地址区域作为启动栈，用来支持后续的程序运行。

在入口的汇编处，通过`.space`预留了一处地址区域，用bookstack、bookstacktop标识起始和结束位置。

指令
```asm=
la sp, bootstacktop
```
的作用是把栈指针寄存器sp指向启动栈的栈顶地址。这就为后续的程序提供了可用的栈空间。有了空间，就需要执行初始程序。之后的指令
```asm=
tail kern_init
```
会将地址无返回地跳转到kern_init的地址。这个符号在`kern/init/init.c`中被定义，对应操作系统内核的主初始化函数。这句指令的作用是将控制权从汇编启动代码移交给 C 语言实现的内核初始化逻辑，完成内核启动的后续工作。

### 练习2：使用GDB验证启动流程

#### 第一阶段

![image](/imgs/test.png)
